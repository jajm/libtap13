include ../config.mk

CFLAGS := -Wall -Wextra -Werror -g -std=c99 $(CFLAGS)
CPPFLAGS := -I../include $(CPPFLAGS)
LDFLAGS := $(LDFLAGS)

PROGRAMS := $(patsubst %.c,%,$(wildcard *.t.c))

all: $(PROGRAMS)

$(PROGRAMS): % : %.o run.o ../src/$(LIBRARY_NAME)
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ $^

.deps/%.d: %.c
	@set -e; rm -f $@; \
	mkdir -p $(dir $@); \
	$(CC) -MM -MT '$(<:.c=.o) $@' -MF $@ $(CPPFLAGS) $<

-include $(patsubst %.c,.deps/%.d,$(wildcard *.c))

%.o: %.c ../src/$(LIBRARY_NAME)
	$(CC) $(CPPFLAGS) $(CFLAGS) -c -o $@ $<

clean:
	rm -rf *.o $(PROGRAMS)
	rm -rf .deps .libs
